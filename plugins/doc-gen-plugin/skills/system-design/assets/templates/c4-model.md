# {システム名} - C4モデル

> **バージョン**: 1.0
> **作成日**: {YYYY-MM-DD}
> **作成者**: {作成者}
> **ステータス**: 下書き | レビュー中 | 承認済み

## 概要

{システムの概要と、このC4モデルが何をドキュメント化するか}

---

## レベル1: システムコンテキスト図

対象システムとユーザー・外部システムとの関係を示す。

```mermaid
C4Context
    title システムコンテキスト図 - {システム名}

    Person(user, "ユーザー", "ユーザーの役割の説明")
    Person(admin, "管理者", "管理者の役割の説明")

    System(system, "対象システム", "システムの説明")

    System_Ext(extA, "外部システムA", "説明")
    System_Ext(extB, "外部システムB", "説明")

    Rel(user, system, "利用する", "HTTPS")
    Rel(admin, system, "管理する", "HTTPS")
    Rel(system, extA, "データを送信", "REST API")
    Rel(system, extB, "データを取得", "gRPC")
```

### コンテキストサマリー

| 要素 | 種別 | 説明 |
|:-----|:-----|:-----|
| {名前} | ユーザー / システム / 外部 | {説明} |

### 主要な関係

| 送信元 | 送信先 | 説明 | プロトコル |
|:-------|:-------|:-----|:----------|
| {送信元} | {送信先} | {データ/アクション} | {プロトコル} |

---

## レベル2: コンテナ図

システム内のコンテナ（アプリケーション、データストアなど）を示す。

```mermaid
C4Container
    title コンテナ図 - {システム名}

    Person(user, "ユーザー", "")

    System_Boundary(system, "対象システム") {
        Container(web, "Webアプリ", "React", "ユーザーにSPAを提供")
        Container(api, "APIサーバー", "Node.js", "ビジネスロジックとAPIを処理")
        ContainerDb(db, "データベース", "PostgreSQL", "アプリケーションデータを保存")
        Container(cache, "キャッシュ", "Redis", "頻繁にアクセスされるデータをキャッシュ")
        Container(queue, "メッセージキュー", "RabbitMQ", "非同期タスク処理")
        Container(worker, "ワーカー", "Node.js", "バックグラウンドタスクを処理")
    }

    System_Ext(extA, "外部システムA", "")

    Rel(user, web, "利用する", "HTTPS")
    Rel(web, api, "API呼び出し", "HTTPS/JSON")
    Rel(api, db, "読み書き", "TCP")
    Rel(api, cache, "読み書き", "TCP")
    Rel(api, queue, "メッセージ発行", "AMQP")
    Rel(queue, worker, "メッセージ消費", "AMQP")
    Rel(api, extA, "呼び出し", "REST API")
```

### コンテナサマリー

| コンテナ | 技術 | 責務 |
|:---------|:-----|:-----|
| {名前} | {技術} | {何をするか} |

### 通信プロトコル

| 送信元 | 送信先 | プロトコル | 同期/非同期 | 備考 |
|:-------|:-------|:----------|:-----------|:-----|
| {送信元} | {送信先} | {プロトコル} | 同期/非同期 | {備考} |

---

## レベル3: コンポーネント図

特定のコンテナ内部のコンポーネントを示す。

### {コンテナ名} - コンポーネント

```mermaid
C4Component
    title コンポーネント図 - {コンテナ名}

    Container_Boundary(api, "APIサーバー") {
        Component(controller, "コントローラー", "Express Router", "HTTPリクエストを処理")
        Component(service, "サービスレイヤー", "TypeScript", "ビジネスロジック")
        Component(repo, "リポジトリ", "TypeScript", "データアクセスの抽象化")
        Component(auth, "認証モジュール", "Passport.js", "認証・認可")
    }

    ContainerDb(db, "データベース", "PostgreSQL", "")
    Container(cache, "キャッシュ", "Redis", "")

    Rel(controller, auth, "トークン検証")
    Rel(controller, service, "呼び出し")
    Rel(service, repo, "利用する")
    Rel(repo, db, "クエリ", "SQL")
    Rel(service, cache, "取得/設定", "TCP")
```

### コンポーネントサマリー

| コンポーネント | 技術 | 責務 | インターフェース |
|:-------------|:-----|:-----|:---------------|
| {名前} | {技術} | {何をするか} | {他からの利用方法} |

### 依存関係

| コンポーネント | 依存先 | 理由 |
|:-------------|:-------|:-----|
| {コンポーネント} | {依存先} | {理由} |

---

## 横断的関心事

### 認証・認可

| 観点 | アプローチ |
|:-----|:---------|
| 方式 | {例: JWT Bearerトークン} |
| 認可モデル | {例: RBAC} |
| トークンライフサイクル | {例: アクセス1時間 + リフレッシュ7日} |

### オブザーバビリティ

| 観点 | ツール | 詳細 |
|:-----|:-------|:-----|
| ログ | {ツール} | {アプローチ} |
| メトリクス | {ツール} | {主要な指標} |
| トレーシング | {ツール} | {アプローチ} |

### エラーハンドリング

| レイヤー | 戦略 |
|:--------|:-----|
| {レイヤー} | {エラーの処理方法} |

## 付録

### 用語集

| 用語 | 定義 |
|:-----|:-----|
| {用語} | {定義} |

### 変更履歴

| バージョン | 日付 | 変更内容 | 変更者 |
|:-----------|:-----|:---------|:-------|
| 1.0 | {YYYY-MM-DD} | 初版作成 | {作成者} |
